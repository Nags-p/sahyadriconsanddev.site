<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unsubscribe</title>
    <link href="images/logo.png" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #f4f4f7; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 90vh; color: #333; }
        .container { background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; padding: 40px 30px; max-width: 500px; width: 90%; }
        .logo { max-width: 180px; margin-bottom: 25px; }
        h1 { color: #1a1a1a; font-weight: 600; font-size: 24px; margin-bottom: 15px; }
        p { color: #555; font-size: 16px; line-height: 1.6; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #8D6E63; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #success-message, #error-message { display: none; }
        .footer { margin-top: 30px; font-size: 14px; color: #888; }
        .footer a { color: #8D6E63; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

<div class="container">
    <img src="images/logo.png" alt="Sahyadri Constructions Logo" class="logo">
    
    <!-- Loading State -->
    <div id="loading-message">
        <h1>Processing...</h1>
        <div class="spinner"></div>
        <p>Please wait while we process your unsubscribe request.</p>
    </div>

    <!-- Success State -->
    <div id="success-message">
        <h1>Successfully Unsubscribed</h1>
        <p>Your email address <strong id="unsubscribed-email"></strong> has been removed from our mailing list.</p>
        <div class="footer">
            <p>You can return to our main site by <a href="https://www.sahyadriconstructionsanddevelopers.great-site.net/">clicking here</a>.</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="error-message">
        <h1 style="color: #d9534f;">Request Failed</h1>
        <p>We're sorry, but an error occurred while processing your request. Please try again later or contact support.</p>
        <p id="error-details" style="font-size: 12px; color: #999;"></p>
    </div>

</div>
<script>
    // --- PASTE YOUR GOOGLE APPS SCRIPT URL HERE ---
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbztocQ8b1iBQRTsSF1_ERZnMbTY84sNGtv3VHweclBhObBTmVTUbAKRTvRwxlekyZOT/exec';

    const loadingDiv = document.getElementById('loading-message');
    const successDiv = document.getElementById('success-message');
    const errorDiv = document.getElementById('error-message');

    // This is the function that the Google Script will call by name from its response.
    // The 'data' parameter will be the JSON object { success: true/false, message: '...' }
    function handleResponse(data) {
        loadingDiv.style.display = 'none'; // Hide loading spinner

        if (data.success) {
            const params = new URLSearchParams(window.location.search);
            const email = params.get('email');
            document.getElementById('unsubscribed-email').textContent = email || 'Your email';
            successDiv.style.display = 'block';
        } else {
            document.getElementById('error-details').textContent = `Details: ${data.message}`;
            errorDiv.style.display = 'block';
        }
    }

    // This code runs automatically when the page loads
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        const email = params.get('email');

        if (!email) {
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'block';
            document.getElementById('error-details').textContent = 'Error: No email address was provided in the link.';
            return;
        }

        // --- THE FIX (JSONP method) ---
        // Dynamically create a <script> tag. This is how you make a JSONP request.
        const scriptTag = document.createElement('script');
        // The URL includes the callback parameter, which tells Google Scripts to wrap the response in our 'handleResponse' function.
        scriptTag.src = `${scriptUrl}?email=${encodeURIComponent(email)}&callback=handleResponse`;

        // Handle cases where the script fails to load (e.g., network error, Google server down)
        scriptTag.onerror = function() {
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'block';
            document.getElementById('error-details').textContent = 'A network error occurred. Please check your connection and try again.';
        };

        // Append the script tag to the document to trigger the request.
        document.body.appendChild(scriptTag);
    };
</script>

</body>
</html>